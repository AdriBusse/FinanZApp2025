name: Android Signed Release

on:
  push:
    branches:
      - main
      - release/**
      - hotfix/**
    tags:
      - 'v*'
  pull_request:
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    permissions:
      contents: read

    # Optional: if you store secrets in a specific Environment, set it here
    # environment:
    #   name: production

    env:
      CI: true
      # Helpful Gradle defaults for CI
      GRADLE_OPTS: -Dorg.gradle.daemon=false -Dorg.gradle.parallel=true -Dorg.gradle.jvmargs='-Xmx3g -Dfile.encoding=UTF-8'

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js 20 and cache npm
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install JS dependencies
        run: npm ci

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Gradle cache
        uses: gradle/gradle-build-action@v3

      - name: Ensure Android SDK path in local.properties
        shell: bash
        run: |
          echo "sdk.dir=${ANDROID_SDK_ROOT}" > android/local.properties
          cat android/local.properties

      - name: Accept Android SDK licenses
        shell: bash
        run: yes | "${ANDROID_SDK_ROOT